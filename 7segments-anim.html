<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Untitled Document</title>
<style type="text/css">
.display7{
	display:inline-block;
	background-color: #000;
	padding: 1em;
	
	font:Monaco, "Panic Sans", Consolas, "Courier New", monospace;
	font-size:9px;
	color:transparent;
}
.display7:hover{
	color: black;
}
.display7 .a
.display7 .b,
.display7 .c,
.display7 .d,
.display7 .e,
.display7 .f,
.display7 .g,{
	text-align: center;
}
.display7 div{
	background-color: #111;
	text-align: center;
	cursor: pointer;
}
.a, .g, .g{
	width: 4em;
}
.b, .c, .e, .f{
	width: 1em;
	height: 4em;
}
.display7 div.on{
	background-color: #CF0;
}
#panel{
	text-align: center;
	background: #999;
	padding: 1em;
}
#animationPanel, #storagePanel{
	display: inline-block;
	border: 2px solid gray;
	height:auto;
}
textarea{
	text-align: left;
}
</style></head>

<body>

<div id="panel">
	<div id="digit1" class="display7">
	  <table>
		<tr>
			<td></td>
			<td><div class="a">A</div></td>
			<td></td>
		</tr>
		<tr>
			<td><div class="f">F</div></td>
			<td></td>
			<td><div class="b">B</div></td>
		</tr>
		<tr>
			<td></td>
			<td><div class="g">G</div></td>
			<td></td>
		</tr>
		<tr>
			<td><div class="e">E</div></td>
			<td></td>
			<td><div class="c">C</div></td>
		</tr>
		<tr>
			<td></td>
			<td><div class="d">D</div></td>
			<td></td>
		</tr>
	  </table>
	</div>
	
	<div id="digit2" class="display7">
	  <table>
		<tr>
			<td></td>
			<td><div class="a">A</div></td>
			<td></td>
		</tr>
		<tr>
			<td><div class="f">F</div></td>
			<td></td>
			<td><div class="b">B</div></td>
		</tr>
		<tr>
			<td></td>
			<td><div class="g">G</div></td>
			<td></td>
		</tr>
		<tr>
			<td><div class="e">E</div></td>
			<td></td>
			<td><div class="c">C</div></td>
		</tr>
		<tr>
			<td></td>
			<td><div class="d">D</div></td>
			<td></td>
		</tr>
	  </table>
	</div>

	<br />
	
	<div>
		<input id="dispData" type="text"><input type="button" value="WRITE" onclick="writeDisplay(dispData.value)"/>
	</div>
</div>



<span id="animationPanel">
	
	<button onclick="pushB()">PUSH TO LIST</button>
	<br />
	<p>
		<button onclick="play()">PLAY</button>
		<button onclick="stop()">STOP</button>
		<br />
		<label>Interval <input type="number" id="speed" value="500"/></label><br />
		<label>Repeat <input type="number" id="repeat" value="5"/></label>
	</p>
	
	<textarea id="anim" rows="20" placeholder="">
	</textarea>
</span>

<span id="storagePanel">
	<input type="text" id="animName" placeholder="animation name"/>
	<button onclick="saveAnim()">Save</button>
	<br />
	<button onclick="loadAnim()">Load</button>
	<button onclick="deleteAnim()">Delete</button>
	<br />
	<select id="savedList" size="10" onchange="loadAnim()"></select>
</span>

<script type="text/javascript">
var playing, t, d1, d2;
var savedAnimations = {};
function saveAnim(){
	
	var animObj = {
		name: animName.value,
		interval: speed.value,
		repeat:	 repeat.value,
		data: anim.value
	}
	
	savedAnimations[animObj.name] = animObj;
	
	savedList.innerHTML = "";
	for(var a in savedAnimations){
		var opt = document.createElement('option');
		opt.innerHTML = a;
		opt.value = a;
		savedList.appendChild(opt);
	}
	
	window.localStorage.setItem('savedAnimations', JSON.stringify(savedAnimations) );
}
function loadAnim(){
	var a = savedAnimations[savedList.value];
	animName.value = a.name;
	speed.value = a.interval;
	repeat.value = a.repeat;
	anim.value = a.data;
}
function deleteAnim(){
	if(savedList.value){
		var a = savedAnimations[savedList.value];
		delete savedAnimations[a.name];
		
		savedList.innerHTML = "";
		for(var a in savedAnimations){
			var opt = document.createElement('option');
			opt.innerHTML = a;
			opt.value = a;
			savedList.appendChild(opt);
		}
		
		window.localStorage.setItem('savedAnimations', JSON.stringify(savedAnimations) );
	}
}
function pushB(){
	anim.value += d1.getValue()+" "+d2.getValue()+"\n";
}
function play(){
	
	if(!playing==true){
	
		var sequence = anim.value.split(/\n/);
		var i=0;
		var r = parseInt(repeat.value);
		
		console.log('animation started');
		
		t = setInterval( function(){
			
			if(sequence[i]){
				console.log('animation frame', i, sequence[i]);
				playing = true;
				
				var bytes = sequence[i].split(" ");
				
				writeDisplay(bytes);
				++i;
			}
			else{
				if(r>=0){
					i=0;
					--r;
					console.log('animation repeat');
				}else{
					clearInterval(t);
					playing = false;
					console.log('animation ended.');
				}
			}
			
			
		}, parseInt(speed.value));
	}
	else console.log('already playing!');
}
function stop(){
	playing=false;
	clearInterval(t);
	console.log('animation canceled');
}
/* JAVASCRIPT GOES HERE */
window.onload=function(){
		d1 = new Display(digit1);
		d2 = new Display(digit2);
		
		writeDisplay("1111111 1111111".split(" "));
		
		d1.onChange = d2.onChange = function(){
			dispData.value = d1.getValue() +" "+ d2.getValue();
		}
		
	//Load saved animations to memory
	var storage = window.localStorage.getItem('savedAnimations');
	
	if(storage){
		savedAnimations = JSON.parse(storage);
	}
	else{
		savedAnimations = {"filling bar":{"name":"filling bar","interval":"50","repeat":"5","data":"0001000 0001000\n0001001 0001001\n1001001 1001001\n1000001 1000001\n1000000 1000000\n0000000 0000000"},"rising sides":{"name":"rising sides","interval":"50","repeat":"5","data":"0001000 0001000\n0001100 0011000\n0001110 0111000\n1001110 1111000\n1000110 1110000\n1000010 1100000\n1000000 1000000\n0000000 0000000"},"rising dash":{"name":"rising dash","interval":"50","repeat":"5","data":"0001000 0001000\n0000001 0000001\n1000000 1000000\n0000000 0000000"},"rotating segment":{"name":"rotating segment","interval":"50","repeat":"5","data":"0000000 0001000\n0001000 0000000\n0000100 0000000\n0000010 0000000\n1000000 0000000\n0000000 1000000\n0000000 0100000\n0000000 0010000"},"drawing circle":{"name":"drawing circle","interval":"50","repeat":"5","data":"0000000 0001000\n0001000 0001000\n0001100 0001000\n0001110 0001000\n1001110 0001000\n1001110 1001000\n1001110 1101000\n1001110 1111000\n1001110 1110000\n1000110 1110000\n1000010 1110000\n1000000 1110000\n0000000 1110000\n0000000 0110000\n0000000 0010000\n0000000 0000000"},"spinner":{"name":"spinner","interval":"50","repeat":"5","data":"1000000 0001000\n0001000 1000000\n0000100 0100000\n0000010 0010000\n"},"spinner2":{"name":"spinner2","interval":"40","repeat":"5","data":"1000000 0001000\n1001000 1001000\n0001000 1000000\n0001100 1100000\n0000100 0100000\n0000110 0110000\n0000010 0010000\n1000010 0011000"},"cmd":{"name":"cmd","interval":"200","repeat":"5","data":"1000000 0001000\n0100000 0000100\n0010000 0000010\n0001000 1000000\n0000100 0100000\n0000001 0000001\n0000000 0000000\n0000010 0010000"},"command symbol":{"name":"command symbol","interval":"50","repeat":"5","data":"0000000 0010000\n0000000 0001000\n0000000 0000100\n0000000 0000010\n0000000 1000000\n0000000 0100000\n0000000 0000001\n0000001 0000000\n0000010 0000000\n1000000 0000000\n0100000 0000000\n0010000 0000000\n0001000 0000000\n0000100 0000000\n0000001 0000000\n0000000 0000001"},"fast blink UP":{"name":"fast blink UP","interval":"20","repeat":"5","data":"0111110 1100111\n0000000 0000000"},"fast blink dn":{"name":"fast blink dn","interval":"20","repeat":"5","data":"0111101 0010101\n0000000 0000000\n"},"balance":{"name":"balance","interval":"350","repeat":"5","data":"0000111 0110001\n0000111 0110001\n0000111 0110001\n0000111 0110001\n0010110 0110100\n0010100 0110100\n0010000 0110100\n0000000 0110100\n0000000 0110000\n0000000 0100000\n0000000 0110000\n0000000 0110100\n0010000 0110100\n0010100 0110100\n0010110 0110100\n0000111 0110001\n0010110 0110100\n0010110 0010100\n0010110 0000100\n0010110 0000000\n0000110 0000000\n0000010 0000000\n"}};
	}
	
	
	for(var a in savedAnimations){
		var opt = document.createElement('option');
		opt.innerHTML = a;
		opt.value = a;
		savedList.appendChild(opt);
	}
	
	
	
};
function writeDisplay(bytes){
	d1.setValue(bytes[0]);
	d2.setValue(bytes[1])
	dispData.value = bytes.join(" ");
}
/*
*  Counter.js  - written by Victor N - 22/Nov/2013 - www.vitim.us
*/
function Display(displayElement){
	
	var self = this;
	
	this.pos;
	this.values = [0,1,2,3,4,5,6,7,8,9];
	
	this.options = {
		mousewheel: true,
		digitHeight: 0,
		inverted: false	
	}
	
	this.DOM = {
		display : displayElement,
		segments: [
			displayElement.querySelector('.a'),
			displayElement.querySelector('.b'),
			displayElement.querySelector('.c'),
			displayElement.querySelector('.d'),
			displayElement.querySelector('.e'),
			displayElement.querySelector('.f'),
			displayElement.querySelector('.g')
		]
	}
	
	this.DOM.display.onclick=function(){
		
	}
	
	for(var i=0; i<this.DOM.segments.length; ++i){
		this.DOM.segments[i].onclick = function(){
			this.classList.toggle("on");
			
			if(self.onChange) self.onChange();
		}
	}
	
	/*	
	//Initial Values
	if(this.DOM.counter.innerHTML.indexOf('|')>-1){
		this.values = this.DOM.counter.innerHTML.split('|');
	}
	this.DOM.counter.innerHTML = "";
		
	this.DOM.counter.classList.add('counter');
	this.DOM.wheel.classList.add('wheel');
	this.DOM.digitAbove.classList.add('digit');
	this.DOM.digitCenter.classList.add('digit');
	this.DOM.digitBelow.classList.add('digit');
	this.DOM.digitAbove.classList.add('above');
	this.DOM.digitCenter.classList.add('center');
	this.DOM.digitBelow.classList.add('below');
	
	this.DOM.counter.appendChild(this.DOM.wheel);
	this.DOM.wheel.appendChild(this.DOM.digitAbove);
	this.DOM.wheel.appendChild(this.DOM.digitCenter);
	this.DOM.wheel.appendChild(this.DOM.digitBelow);
	
	//compute digit height
	//this.options.digitHeight = this.DOM.digitCenter.offsetHeight;
	this.options.digitHeight = parseInt(window.getComputedStyle(this.DOM.digitCenter, null).getPropertyValue("height"));
	this.setPos(0);
	
	this.DOM.counter.onmousewheel = this.mouseWheel();
	*/
	
}
Display.prototype.setValue = function(value){
	
	if(typeof value=="number")
		value = value.toString();
	
	for(var i=0; i<this.DOM.segments.length; ++i){
		
		var b = value.charAt(i);
		if(b=="1")
			this.DOM.segments[i].classList.add("on");
		else
			this.DOM.segments[i].classList.remove("on");
	}
	
}
Display.prototype.getValue = function(value){
	
	var byte=[];
	
	for(var i=0; i<this.DOM.segments.length; ++i){
		byte.push( this.DOM.segments[i].classList.contains("on")?1:0)
	}
	
	return byte.join('');
}
</script>
  
</body>
</html>
